<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Binary Prime Engine</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: #fff;
    }
    header {
      background-color: #111;
      padding: 20px;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      color: #00d8ff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .container {
      padding: 30px;
      max-width: 900px;
      margin: auto;
      background-color: #1e1e2f;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0, 216, 255, 0.2);
    }
    .menu {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .menu button {
      background: #00d8ff;
      color: #000;
      padding: 15px;
      font-size: 1.1em;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .menu button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(0,216,255,0.4);
    }
    input[type="number"] {
      width: 250px;
      padding: 12px;
      font-size: 1.2em;
      margin-bottom: 20px;
      border-radius: 10px;
      border: none;
      text-align: center;
    }
    .result {
      margin-top: 25px;
      padding: 15px;
      background-color: #292942;
      border-radius: 10px;
      font-size: 1.1em;
      white-space: pre-line;
    }
    canvas {
      display: block;
      margin: 30px auto 0 auto;
      border-radius: 12px;
      background: #fff;
    }
  </style>
</head>
<body>
<!-- resto del documento verrà aggiunto dopo -->

  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three';

    function isPrime(n) {
      if (n < 2) return false;
      for (let i = 2; i * i <= n; i++) {
        if (n % i === 0) return false;
      }
      return true;
    }

    window.checkPrime = function () {
      const n = parseInt(document.getElementById("inputNumber").value);
      const r = document.getElementById("result");
      if (isNaN(n)) return r.innerText = "Inserisci un numero valido.";
      r.innerText = isPrime(n) ? `${n} è un numero primo ✅` : `${n} non è primo ❌`;
    };

    window.calculateGap = function () {
      const n = parseInt(document.getElementById("inputNumber").value);
      const r = document.getElementById("result");
      if (!isPrime(n)) return r.innerText = `${n} non è primo`;
      let next = n + 1;
      while (!isPrime(next)) next++;
      r.innerText = `Gap dₙ dopo ${n}: ${next - n}`;
    };

    window.findTwins = function () {
      const da = parseInt(prompt("Da (incluso):"));
      const a = parseInt(prompt("A (incluso):"));
      const r = document.getElementById("result");
      if (isNaN(da) || isNaN(a) || da > a) return r.innerText = "Intervallo non valido.";
      const twins = [];
      let last = da - 1;
      for (let n = da; n <= a; n++) {
        if (isPrime(n)) {
          if (n - last === 2) twins.push(`(${last}, ${n})`);
          last = n;
        }
      }
      r.innerText = `Primi gemelli tra ${da} e ${a}:
` + twins.join(", ");
    };

    window.findDoubleTwins = function () {
      const da = parseInt(prompt("Da (incluso):"));
      const a = parseInt(prompt("A (incluso):"));
      const r = document.getElementById("result");
      if (isNaN(da) || isNaN(a) || da > a) return r.innerText = "Intervallo non valido.";
      const doubles = [];
      let last = da - 1;
      for (let n = da; n <= a; n++) {
        if (isPrime(n)) {
          if (n - last === 4) doubles.push(`(${last}, ${n})`);
          last = n;
        }
      }
      r.innerText = `Doppi gemelli (p, p+4) tra ${da} e ${a}:
` + doubles.join(", ");
    };

    window.factorize = function () {
      let n = parseInt(document.getElementById("inputNumber").value);
      const r = document.getElementById("result");
      if (isNaN(n) || n < 2) return r.innerText = "Numero non valido.";
      const factors = [];
      let d = 2;
      while (n > 1 && d <= n) {
        if (n % d === 0) {
          factors.push(d);
          n = Math.floor(n / d);
        } else {
          d++;
        }
      }
      r.innerText = `Fattori primi: ` + factors.join(" × ");
    };

    window.generatePrimes = function () {
      const da = parseInt(prompt("Da (incluso):"));
      const a = parseInt(prompt("A (incluso):"));
      const r = document.getElementById("result");
      if (isNaN(da) || isNaN(a) || da > a) return r.innerText = "Intervallo non valido.";
      const list = [];
      for (let i = da; i <= a; i++) if (isPrime(i)) list.push(i);
      r.innerText = `Primi tra ${da} e ${a}:
` + list.join(", ");
    };

    window.drawSpiral3D = function () {
      const container = document.getElementById("spiral3dContainer");
      container.innerHTML = "";
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf0f0f0);
      const camera = new THREE.PerspectiveCamera(75, 1.8, 0.1, 1000);
      camera.position.z = 120;
      camera.position.y = 40;

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      const width = container.offsetWidth;
      const height = 500;
      renderer.setSize(width, height);
      container.appendChild(renderer.domElement);

      const geometry = new THREE.SphereGeometry(0.5, 12, 12);
      const material = new THREE.MeshBasicMaterial({ color: 0x000000 });
      let angle = 0;
      let radius = 1;
      let heightStep = 0.6;

      for (let n = 2; n < 1000; n++) {
        if (isPrime(n)) {
          const sphere = new THREE.Mesh(geometry, material);
          const x = radius * Math.cos(angle);
          const y = radius * Math.sin(angle);
          const z = n * heightStep * 0.1;
          sphere.position.set(x, y, z);
          scene.add(sphere);
        }
        angle += 0.2;
        radius += 0.02;
      }

      const light = new THREE.PointLight(0xffffff, 1);
      light.position.set(50, 50, 100);
      scene.add(light);

      const animate = function () {
        requestAnimationFrame(animate);
        scene.rotation.z += 0.001;
        scene.rotation.x += 0.001;
        renderer.render(scene, camera);
      };

      animate();
    };

    window.drawSpiral2D = function () {
      const canvas = document.getElementById("spiralCanvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      let angle = 0;
      let radius = 0;

      ctx.fillStyle = "#00d8ff";

      for (let n = 2; n < 1000; n++) {
        if (isPrime(n)) {
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);
          ctx.beginPath();
          ctx.arc(x, y, 3, 0, 2 * Math.PI);
          ctx.fill();
        }
        radius += 0.5;
        angle += 0.2;
      }
    };
  </script>
  <header>Binary Prime Engine</header>
  <div class="container">
    <input type="number" id="inputNumber" placeholder="Inserisci un numero">
    <div class="menu">
      <button onclick="checkPrime()">Verifica se primo</button>
      <button onclick="calculateGap()">Gap dₙ</button>
      <button onclick="findTwins()">Primi gemelli</button>
      <button onclick="findDoubleTwins()">Doppi gemelli</button>
      <button onclick="factorize()">Scomposizione</button>
      <button onclick="generatePrimes()">Genera intervallo</button>
      <button onclick="drawSpiral2D()">Spirale 2D</button>
      <button onclick="drawSpiral3D()">Spirale 3D</button>
    </div>
    <div class="result" id="result"></div>
    <canvas id="spiralCanvas" width="600" height="600"></canvas>
    <div id="spiral3dContainer" style="width:100%; height:500px; margin-top:30px;"></div>
  </div>
</body>
</html>
